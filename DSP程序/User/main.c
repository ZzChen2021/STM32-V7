/*
*********************************************************************************************************
*
*	??????? : ?????????
*	??????? : main.c
*	??    ?? : V1.0
*	?    ?? : ARM???DSP?????
*              ???????
*                1. ?????DSP????????
*              ????????
*                1. ????????K1, ??????????arm_abs_f32??????????
*                2. ????????K2, ??????????arm_abs_q31??????????
*                3. ????????K3, ??????????arm_abs_q15??????????
*              ???????
*                1. ??????????????????SecureCRT????????????????115200????????8??????????????????1??
*                2. ????????????????????TAB?????4????????????????????????????
*
*	????? :
*		?????   ????         ????        ???
*		V1.0    2019-07-31   Eric2013     1. CMSIS??????? V5.6.0
*                                         2. HAL???? V1.3.0
*
*	Copyright (C), 2018-2030, ?????????? www.armfly.com
*
*********************************************************************************************************
*/	
#include "bsp.h"			/* ?????????? */
#include "arm_math.h"



/* ??????????????????????? */
#define EXAMPLE_NAME	"V7-ARM??DSP????????????"
#define EXAMPLE_DATE	"2019-07-31"
#define DEMO_VER		"1.0"

static void PrintfLogo(void);
static void PrintfHelp(void);

/*
*********************************************************************************************************
*	?? ?? ??: main
*	???????: c???????
*	??    ??: ??
*	?? ?? ?: ???????(???????)
*********************************************************************************************************
*/
int main(void)
{
	uint8_t ucKeyCode;		/* ???????? */
	float32_t pSrc;
    float32_t pDst;
	q31_t pSrc1;
	q31_t pDst1;
	q15_t pSrc2;
	q15_t pDst2;

	
	bsp_Init();		/* ???????? */
	
	PrintfLogo();	/* ??????????????????? */
	PrintfHelp();	/* ?????????? */

	bsp_StartAutoTimer(0, 100);	/* ????1??100ms?????????????? */
	
	/* ?????????? */
	while (1)
	{
		/* CPU????????????????? bsp.c */
		bsp_Idle();		
		
		/* ?????????????? */
		if (bsp_CheckTimer(0))	
		{
			/* ???100ms ??????? */
			/* ???LED2???? */
			bsp_LedToggle(2);	
		}

		/* ??????????? */
		ucKeyCode = bsp_GetKey();
		if (ucKeyCode > 0)
		{
			/* ???????? */
			switch (ucKeyCode)
			{
				case KEY_DOWN_K1:			   /* K1?????? */
					pSrc -= 1.23f;
					arm_abs_f32(&pSrc, &pDst, 1);
					printf("pDst = %f\r\n", pDst);
					break;
					
				case KEY_DOWN_K2:				/* K1?????? */
					pSrc1 -= 1;
					arm_abs_q31(&pSrc1, &pDst1, 1);
					printf("pDst1 = %d\r\n", pDst1);
					break;

				case KEY_DOWN_K3:				/* K2?????? */
					pSrc2 -= 1;
					arm_abs_q15(&pSrc2, &pDst2, 1);
					printf("pDst2 = %d\r\n", pDst2);
					break;
				
				default:
					break;
			}
		}
	}
}

/*
*********************************************************************************************************
*	?? ?? ??: PrintfHelp
*	???????: ??????????
*	??    ??????
*	?? ?? ?: ??
*********************************************************************************************************
*/
static void PrintfHelp(void)
{
	printf("???????:\r\n");
	printf("1. ?????????????????????????100ms??????LED2\r\n");
	printf("2. ????????K1, ??????????arm_abs_f32????????\r\n");
	printf("3. ????????K2, ??????????arm_abs_q31????????\r\n");
	printf("4. ????????K3, ??????????arm_abs_q15????????\r\n");
}

/*
*********************************************************************************************************
*	?? ?? ??: PrintfLogo
*	???????: ???????????????????????, ???????????PC??????????????????????
*	??    ??????
*	?? ?? ?: ??
*********************************************************************************************************
*/
static void PrintfLogo(void)
{
	printf("*************************************************************\n\r");
	
	/* ???CPU ID */
	{
		uint32_t CPU_Sn0, CPU_Sn1, CPU_Sn2;
		
		CPU_Sn0 = *(__IO uint32_t*)(0x1FF1E800);
		CPU_Sn1 = *(__IO uint32_t*)(0x1FF1E800 + 4);
		CPU_Sn2 = *(__IO uint32_t*)(0x1FF1E800 + 8);

		printf("\r\nCPU : STM32H743XIH6, BGA240, ???: %dMHz\r\n", SystemCoreClock / 1000000);
		printf("UID = %08X %08X %08X\n\r", CPU_Sn2, CPU_Sn1, CPU_Sn0);
	}

	printf("\n\r");
	printf("*************************************************************\n\r");
	printf("* ????????   : %s\r\n", EXAMPLE_NAME);	/* ??????????? */
	printf("* ??????   : %s\r\n", DEMO_VER);		/* ????????? */
	printf("* ????????   : %s\r\n", EXAMPLE_DATE);	/* ??????????? */

	/* ???ST??HAL???? */
	printf("* HAL????  : V1.3.0 (STM32H7xx HAL Driver)\r\n");
	printf("* \r\n");	/* ????????? */
	printf("* QQ    : 1295744630 \r\n");
	printf("* ????  : armfly\r\n");
	printf("* Email : armfly@qq.com \r\n");
	printf("* ???????: armfly_com \r\n");
	printf("* ?????: armfly.taobao.com\r\n");
	printf("* Copyright www.armfly.com ??????????\r\n");
	printf("*************************************************************\n\r");
}

/***************************** ?????????? www.armfly.com (END OF FILE) *********************************/
